-- Which item was purchased first by the customer after they become  a member

select * from goldusers_signup;
select * from sales;
select * from product;

select * from 
(select a.*,rank()over(partition by userid order by created_date asc) as rnk from
(select g.userid,g.gold_signup_date,s.created_date,s.product_id from goldusers_signup g
Inner Join sales s on s.userid = g.userid
where g.gold_signup_date <= s.created_date)a)b
where rnk = 1;

-- Which item was purchased first by the customer before they become  a member

select * from 
(select a.*,rank()over(partition by userid order by created_date desc) as rnk from
(select g.userid,g.gold_signup_date,s.created_date,s.product_id from goldusers_signup g
Inner Join sales s on s.userid = g.userid
where g.gold_signup_date >= s.created_date)a)b
where rnk = 1;

-- What is the total orders and amount spent for each member before they become a member

select userid,count(created_date) as order_count, sum(price) as Total_spent from
(select g.userid,g.gold_signup_date,s.created_date,s.product_id,p.price from goldusers_signup g
Inner Join sales s on s.userid = g.userid
Inner Join product p on p.product_id = s.product_id
where g.gold_signup_date >= s.created_date)a
group by userid;

